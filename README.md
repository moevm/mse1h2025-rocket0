# mse-2025-template

## Инструкция по запуску

- Склонировать репозиторий и перейти в папку с ним
- скопировать настройки среды командой `cp .env.example .env`
- Прописать команду:`make chat-compose-up`. Она создаст инстанс рокетчата и поднимет контейнер с ним: нужно дождать полной загрузки:

![изображение](https://github.com/user-attachments/assets/d38cc4d4-6c44-40e4-a3ae-d9812d30501e)

- Подгрузить дамп чата `make load-chat-dump`, подождать, пока дамп подгрузится

![изображение](https://github.com/user-attachments/assets/8fb09596-bdb6-4078-91ba-594c78bf2c41)

- Прописать команду `make bot-compose-up`: она поднимет бота и подключится к инстансу рокетчата. Также нужно подождать, пока бот загрузится полностью:

![изображение](https://github.com/user-attachments/assets/504b1e63-b1d7-44bf-a4b5-03578cf754ed)

- Подключиться к рокетчату через браузер по `localhost:3000`
- Авторизоваться: логин `for_dump`; пароль `123456`

![изображение](https://github.com/user-attachments/assets/fe322cc4-1470-446c-b57b-44dc9f3ddd21)

Если все сделано правильно, то на экране откроется рокет чат с 5 каналами:

![изображение](https://github.com/user-attachments/assets/33a3f4fe-4833-4c97-b9d7-46ce12ee1783)

- для проверки, что бот доступен, напишите в канал #general команду `!find_unanswered` - в ответ бот должен переслать сообщения без ответа:

![изображение](https://github.com/user-attachments/assets/c4cd27b1-d08b-4184-b296-54b69509f3cf)

- команды `make bot-compose-down` и `make chat-compose-down` соответственно удалят ранее поднятые контейнеры, если вы закончили работу

## Доступные команды боту

- `!find_unanswered` : пересылает все сообщения без ответа, которые были в открытых или закрытых каналах (команды бота или сообщения со специфической реакцией :gear: не учитываются). Доступны флаги `--from` и `--to`  с указанием времени в формате `ГГГГ-ММ-ДД ЧЧ:ММ:СС`: позволяют сделать срез с определенной даты и до определенной даты. (пример: `!find_unanswered --from 2025-05-12 18:33:01 --to 2025-05-13 18:33:01`)
- `!stats` : присылает в ответ статистику по инстансу в csv файле, собранную с открытых и закрытых каналов. Доступны флаги: `--from` и `--to`  с указанием времени в формате `ГГГГ-ММ-ДД ЧЧ:ММ:СС`: позволяют сделать срез с определенной даты и до определенной даты; а также флаги `--users`, `--roles` и `--channels`, с указанием пользователей, каналов или ролей после соответствующего флага, чтобы сделать статистику уже по запросу пользователя. (пример: `!stats --from 2025-05-12 18:33:01 --to 2025-05-13 18:33:01 --users for_dump`)
- `find_message` : пересылает в ответ все сообщения, которые соответствуют заданному регулярным выражением паттерну. (пример: `!find_message Вопрос\sбез\sответа`) Замечание: пробелы нужно заменять \s, иначе символы после них будут отбрасываться.
- (!Не применять, если не настроена интеграция с Telegram) `!time` : если настроена интеграция с Telegram (см Интеграция с Telegram ниже), то присылает уведомление пользователю в Telegram и выводит текущее время.

## Доступные возможности

- При написании сообщения в чат со знаком вопроса, бот ответит на него в треде полезными ссылками (пока что просто ссылкой одной)
- Привилегированные пользователи (роли задаются в .env, по умолчанию - admin) могут ставить реакции :gear: на сообщения, чтобы бот игнорировал их (реакция поставленная пользователем других ролей учитываться не будет)

## Интеграция с Telegram
- Создайте своего бота, используя [@BotFather](https://t.me/BotFather). Инструкции по созданию бота есть в интернете, например: [ссылка](https://marketolog.mts.ru/blog/kak-sozdat-bota-v-botfather-gaid-dlya-novichkov).
- В файле `.env` с новой строки запишите токен, созданного вами бота (который выглядит как `123456:ABC-DEF1234ghIkl`) в формате `TELEGRAM_TOKEN=<your token>` (смотрите пример в файле [`.env.example`](.env.example)).
- Узнайте свой ID пользователя в Telegram. Для этого вы можете воспользоваться ботом [@getmyid_bot](https://t.me/getmyid_bot) (скопируйте именно **user ID**, а не **chat ID**).
- В файле `.env` с новой строки запишите ID пользователей, которым бот должен присылать сообщения в формате (`TELEGRAM_USERS_ALLOW_LIST=875,8907`) (смотрите пример в файле [`.env.example`](.env.example)). Можно указать один ID, можно несколько через запятую.
- Отправьте вашему боту команду `/start` в Telegram-чате. Он никак не отреагирует - это нормально. Это нужно, чтобы бот мог писать вам сообщения (если бот должен оповещать нескольких пользователей, все они также должны запустить у себя бота).

Если всё пройдёт успешно, бот будет присылать вам сообщения подобного вида: `requests:INFO - Command.TIME None`
